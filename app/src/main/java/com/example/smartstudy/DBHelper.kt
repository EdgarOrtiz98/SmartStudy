package com.example.smartstudyimport android.content.ContentValuesimport android.content.Contextimport android.database.Cursorimport android.database.sqlite.SQLiteDatabaseimport android.database.sqlite.SQLiteOpenHelperimport androidx.core.content.contentValuesOfclass DBHelper(context: Context): SQLiteOpenHelper(context, SmartStudy, null, DB_VERSION) {    companion object{        private const val SmartStudy = "App.db"        private const val DB_VERSION = 1    }    override fun onCreate(db: SQLiteDatabase?) {        // tabla de usuarios        val query = ("CREATE TABLE USUARIOS("+                "ID INTEGER PRIMARY KEY AUTOINCREMENT, "+                "NOMBRE TEXT, "+                "CORREO TEXT, "+                "USUARIO TEXT, "+                "CONTRASENA TEXT)")        db?.execSQL(query)        // clases        val clases = ("CREATE TABLE CLASES("+                "ID INTEGER PRIMARY KEY AUTOINCREMENT, "+                "ASIGNATURA TEXT, "+                "AULA TEXT, "+                "PROFESOR TEXT, "+                "DIA TEXT, "+                "HORA_INICIO TEXT, "+                "HORA_FIN TEXT)")        db?.execSQL(clases)        // Tareas        val tareas = ("CREATE TABLE TAREAS("+                "ID INTEGER PRIMARY KEY AUTOINCREMENT, "+                "NOMBRE TEXT, "+                "ASIGNATURA TEXT, "+                "FECHA TEXT, "+                "INSTRUPCIONES TEXT)")        db?.execSQL(tareas)    }    override fun onUpgrade(db: SQLiteDatabase?, oldVersion: Int, newVersion: Int) {        val query = "DROP TABLE IF EXISTS USUARIOS"        db?.execSQL(query)        onCreate(db)        val clases = "DROP TABLE IF EXISTS CLASES"        db?.execSQL(clases)        onCreate(db)        val tareas = "DROP TABLE IF EXISTS TAREAS"        db?.execSQL(tareas)        onCreate(db)    }    // insertar datos ala base de datos    fun insertarUsuario(nombre: String, correo: String, user: String, pass: String): Long{        val values = ContentValues().apply {            put("NOMBRE", nombre)            put("CORREO", correo)            put("USUARIO", user)            put("CONTRASENA", pass)        }        return writableDatabase.insert("USUARIOS", null, values)    }    // Validar Usuarios Login    fun leerUsuario(name: String, pass: String): Boolean{        val args = arrayOf(name, pass)        val consulta = readableDatabase.query("USUARIOS", null, "USUARIO = ? AND  CONTRASENA = ?", args, null, null, null)        val usuario = consulta.count > 0        consulta.close()        return usuario    }    // Perfil    // Ver datos del usuario    fun verPerfil(sql: String): Cursor?{        val db = readableDatabase        return db.rawQuery(sql, null)    }    // Editar usuario    fun actualizar(id: Int, nombre: String, correo: String, usuario: String, contrasena: String): Int {        val args = arrayOf(id.toString())        val values = ContentValues().apply {            put("NOMBRE", nombre)            put("CORREO", correo)            put("USUARIO", usuario)            put("CONTRASENA", contrasena)        }        return writableDatabase.update("USUARIOS", values, "ID = ?", args)    }    // mostar datos en el formulario    fun leerActualizar(ID: Int): Cursor? {        val arg = arrayOf(ID.toString())        val db = readableDatabase        return db.rawQuery("SELECT * FROM USUARIOS WHERE ID = ?", arg)    }    // Clases    // Insertar datos    fun insertarClases(asign: String, aula: String, profe: String, dia: String, horaI: String, horaF: String): Long{        val values = ContentValues().apply {            put("ASIGNATURA", asign)            put("AULA", aula)            put("PROFESOR", profe)            put("DIA", dia)            put("HORA_INICIO", horaI)            put("HORA_FIN", horaF)        }        return writableDatabase.insert("CLASES", null, values)    }    // RecicllerView para mostar clases    fun verClases(): Cursor? {        val Clases = this.writableDatabase        val consulta = Clases.rawQuery("SELECT * FROM CLASES ORDER BY CASE WHEN DIA = 'Lunes' THEN 1 WHEN DIA = 'Martes' THEN 2 WHEN DIA = 'Miércoles' THEN 3 WHEN DIA = 'Jueves' THEN 4 WHEN DIA = 'Viernes' THEN 5 WHEN DIA = 'Sábado' THEN 6 WHEN DIA = 'Domingo' THEN 7 ELSE 8 END, HORA_INICIO;\n", null)        return consulta    }    // Ver detalles de las clases    fun obtenerDetallesClase(id: String?): DatalistClase? {        val db = this.readableDatabase        val columns = arrayOf("ASIGNATURA", "AULA", "PROFESOR", "DIA", "HORA_INICIO", "HORA_FIN")        val selection = "ID = ?"        val selectionArgs = arrayOf(id)        val cursor = db.query("CLASES", columns, selection, selectionArgs, null, null, null)        var clase: DatalistClase? = null        if (cursor.moveToFirst()) {            val materia = cursor.getString(cursor.getColumnIndex("ASIGNATURA"))            val aula = cursor.getString(cursor.getColumnIndex("AULA"))            val profe = cursor.getString(cursor.getColumnIndex("PROFESOR"))            val dia = cursor.getString(cursor.getColumnIndex("DIA"))            val horaI = cursor.getString(cursor.getColumnIndex("HORA_INICIO"))            val horaF = cursor.getString(cursor.getColumnIndex("HORA_FIN"))            clase = DatalistClase(materia, aula, profe, dia, horaI, horaF, horaF)        }        cursor.close()        return clase    }    // Eliminar Clase    fun eliminarClase(id: String?): Int {        val db = this.writableDatabase        val selection = "ID = ?"        val selectionArgs = arrayOf(id)        return db.delete("CLASES", selection, selectionArgs)    }    // mostar datos en el formulario    fun formUpdateClase(ID: Int): Cursor? {        val arg = arrayOf(ID.toString())        val db = readableDatabase        return db.rawQuery("SELECT * FROM CLASES WHERE ID = ?", arg)    }    // Editar Clase    fun actualizarClase(id: String?, asign: String, aula: String, profe: String, dia: String, horaI: String, horaF: String): Int {        try {            val args = arrayOf(id.toString())            val values = contentValuesOf().apply {                put("ASIGNATURA", asign)                put("AULA", aula)                put("PROFESOR", profe)                put("DIA", dia)                put("HORA_INICIO", horaI)                put("HORA_FIN", horaF)            }            return writableDatabase.update("CLASES", values, "ID = ?", args)        } catch (e: Exception) {            e.printStackTrace()            return -1        }    }    // Tareas    // Insertar datos de Tareas    fun insertarTarea(nombre: String, asignatura: String, fecha: String, instrucciones: String): Long {        val values = ContentValues().apply {            put("NOMBRE", nombre)            put("ASIGNATURA", asignatura)            put("FECHA", fecha)            put("INSTRUPCIONES", instrucciones)        }        return try {            writableDatabase.insert("TAREAS", null, values)        } catch (e: Exception) {            -1L        }    }    // Ver datos en ReciclerView de Tarea    fun verTareas(): Cursor? {        val Tareas = this.writableDatabase        val consulta = Tareas.rawQuery("SELECT * FROM TAREAS WHERE FECHA >= strftime('%d-%m-%Y', 'now', '-1 day') ORDER BY FECHA ASC;", null)        return consulta    }    // Ver Detalles de Tarea    fun obtenerDetallesTarea(id: String?): Tarea? {        val db = this.readableDatabase        val columns = arrayOf("NOMBRE", "ASIGNATURA", "FECHA", "INSTRUPCIONES")        val selection = "ID = ?"        val selectionArgs = arrayOf(id)        val cursor = db.query("TAREAS", columns, selection, selectionArgs, null, null, null)        var tarea: Tarea? = null        if (cursor.moveToFirst()) {            val nombre = cursor.getString(cursor.getColumnIndex("NOMBRE"))            val asignatura = cursor.getString(cursor.getColumnIndex("ASIGNATURA"))            val fecha = cursor.getString(cursor.getColumnIndex("FECHA"))            val instrucciones = cursor.getString(cursor.getColumnIndex("INSTRUPCIONES"))            tarea = Tarea(nombre, asignatura, fecha, instrucciones)        }        cursor.close()        return tarea    }    // Eliminar Tarea    fun eliminarTarea(id: String?): Int {        val db = this.writableDatabase        val selection = "ID = ?"        val selectionArgs = arrayOf(id)        return db.delete("TAREAS", selection, selectionArgs)    }    // mostar datos en el formulario    fun formUpdateTarea(id: Int): Cursor? {        val arg = arrayOf(id.toString())        val db = readableDatabase        return db.rawQuery("SELECT * FROM TAREAS WHERE ID = ?", arg)    }    // Editar Tarea    fun actualizarTarea(id: String?, nombre: String, asignatura: String, fecha: String, instrucciones: String): Int {        try {            val args = arrayOf(id.toString())            val values = contentValuesOf().apply {                put("NOMBRE", nombre)                put("ASIGNATURA", asignatura)                put("FECHA", fecha)                put("INSTRUPCIONES", instrucciones)            }            return writableDatabase.update("TAREAS", values, "ID = ?", args)        } catch (e: Exception) {            e.printStackTrace()            return -1        }    }    // Agenda    // Ver datos en ReciclerView de Tarea de hoy en Agenda    fun verTareasAgenda(): Cursor? {        val tareas = this.writableDatabase        val columns = arrayOf("NOMBRE", "ASIGNATURA", "FECHA", "INSTRUPCIONES")        val selection = "FECHA = strftime('%d/%m/%Y', 'now')"        val cursor = tareas.query("TAREAS", columns, selection, null, null, null, null)        return cursor    }}